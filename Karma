-- Murder Mystery 2 Ultimate Cheat GUI (FIXED ESP & FLING v8.1)
-- –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π —Å–∫—Ä–∏–ø—Ç. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã ESP, Fling, Fly, –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ ESP.

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera

local Window = Rayfield:CreateWindow({
    Name = "üé≠ MM2 ULTIMATE CHEAT v8.1",
    LoadingTitle = "–ó–∞–≥—Ä—É–∑–∫–∞...",
    LoadingSubtitle = "–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã",
    ConfigurationSaving = { Enabled = true, FolderName = "MM2Cheat", FileName = "Config" },
    Discord = { Enabled = false },
    KeySystem = false
})

-- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
local ESPEnabled = false
local ChamsEnabled = false
local TracersEnabled = false
local FlyEnabled = false
local FlySpeed = 60
local AutoFarmEnabled = false
local AutoGrabGunEnabled = false
local KillAllEnabled = false
local AutoKillAllEnabled = false
local SilentAimEnabled = false
local ESPObjects = {}
local FlingToggles = {}

-- ESP —Ñ—É–Ω–∫—Ü–∏–∏
local function RemoveESP(player)
    if ESPObjects[player] then
        for _, obj in pairs(ESPObjects[player]) do
            if typeof(obj) == "Instance" and obj.Parent then
                obj:Destroy()
            end
        end
        ESPObjects[player] = nil
    end
end

local function UpdatePlayerESP(player)
    local espData = ESPObjects[player]
    if not espData then return end
    local role, color, displayText = "Innocent", Color3.new(0, 1, 0), player.Name

    -- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏
    for _, container in ipairs({player.Backpack, player.Character}) do
        if container then
            for _, tool in ipairs(container:GetChildren()) do
                if tool:IsA("Tool") then
                    local toolName = string.lower(tool.Name)
                    if toolName:find("knife") or toolName:find("–Ω–æ–∂") then
                        role = "MURDER"
                        color = Color3.new(1, 0, 0)
                        displayText = "üî™ " .. player.Name .. " - –£–ë–ò–ô–¶–ê"
                    elseif toolName:find("gun") or toolName:find("revolver") then
                        role = "SHERIFF"
                        color = Color3.new(0, 0, 1)
                        displayText = "üî´ " .. player.Name .. " - –®–ï–†–ò–§"
                    end
                end
            end
        end
    end

    if espData.Highlight then
        espData.Highlight.FillColor = color
        espData.Highlight.OutlineColor = color
        espData.Highlight.Enabled = ChamsEnabled
    end
    if espData.Tracer then
        espData.Tracer.BackgroundColor3 = color
        espData.Tracer.Visible = TracersEnabled
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local rootPart = player.Character.HumanoidRootPart
            local screenPos, onScreen = Camera:WorldToViewportPoint(rootPart.Position)
            if onScreen then
                local x = screenPos.X / Camera.ViewportSize.X
                espData.Tracer.Position = UDim2.new(x, 0, 0.97, 0)
                espData.Tracer.Visible = TracersEnabled
            else
                espData.Tracer.Visible = false
            end
        else
            espData.Tracer.Visible = false
        end
    end
    if espData.InfoLabel then
        espData.InfoLabel.Text = displayText
        espData.InfoLabel.TextColor3 = color
        espData.InfoLabel.Visible = ESPEnabled
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local rootPart = player.Character.HumanoidRootPart
            local screenPos, onScreen = Camera:WorldToViewportPoint(rootPart.Position + Vector3.new(0, 3, 0))
            if onScreen then
                espData.InfoLabel.Position = UDim2.new(0, screenPos.X - 100, 0, screenPos.Y - 20)
                espData.InfoLabel.Visible = ESPEnabled
            else
                espData.InfoLabel.Visible = false
            end
        else
            espData.InfoLabel.Visible = false
        end
    end
end

local function CreateESP(player)
    if ESPObjects[player] or not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end

    -- Highlight –¥–ª—è Chams
    local highlight = Instance.new("Highlight")
    highlight.Name = "Chams_" .. player.Name
    highlight.Adornee = player.Character
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.FillTransparency = 0.7
    highlight.OutlineTransparency = 0.3
    highlight.Enabled = false
    highlight.Parent = player.Character

    -- –¢—Ä–µ–π—Å–µ—Ä
    local tracer = Instance.new("Frame")
    tracer.Name = "Tracer_" .. player.Name
    tracer.BackgroundColor3 = Color3.new(1, 0, 0)
    tracer.BorderSizePixel = 0
    tracer.Size = UDim2.new(0, 4, 0, 2)
    tracer.AnchorPoint = Vector2.new(0.5, 0.5)
    tracer.Position = UDim2.new(0.5, 0, 1, -20)
    tracer.Visible = false
    tracer.Parent = game:GetService("CoreGui")

    -- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
    local infoLabel = Instance.new("TextLabel")
    infoLabel.Name = "Info_" .. player.Name
    infoLabel.BackgroundTransparency = 1
    infoLabel.Text = ""
    infoLabel.TextColor3 = Color3.new(1, 1, 1)
    infoLabel.TextSize = 14
    infoLabel.Font = Enum.Font.GothamBold
    infoLabel.Size = UDim2.new(0, 200, 0, 20)
    infoLabel.Position = UDim2.new(0, 0, 0, 0)
    infoLabel.Visible = false
    infoLabel.Parent = game:GetService("CoreGui")

    ESPObjects[player] = {
        Highlight = highlight,
        Tracer = tracer,
        InfoLabel = infoLabel
    }
    UpdatePlayerESP(player)
end

local function UpdateAllESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            if not ESPObjects[player] and (ESPEnabled or ChamsEnabled or TracersEnabled) then
                CreateESP(player)
            end
            if ESPObjects[player] then
                UpdatePlayerESP(player)
            end
        end
    end
end

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        wait(0.75)
        if ESPEnabled or ChamsEnabled or TracersEnabled then
            CreateESP(player)
        end
    end)
end)

Players.PlayerRemoving:Connect(function(player)
    RemoveESP(player)
end)

-- FLY SYSTEM (—Ñ–∏–∫—Å–∞—Ü–∏—è –ø–æ–ª–µ—Ç–∞)
local FlyBV
local function DisableFly()
    FlyEnabled = false
    if FlyBV and FlyBV.Parent then
        FlyBV:Destroy()
    end
    FlyBV = nil
end

local function EnableFly()
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
    FlyEnabled = true
    FlyBV = Instance.new("BodyVelocity")
    FlyBV.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    FlyBV.Velocity = Vector3.new(0,0,0)
    FlyBV.Parent = LocalPlayer.Character.HumanoidRootPart
end

RunService.RenderStepped:Connect(function()
    if FlyEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and FlyBV then
        local move = Vector3.new()
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then move = move + Camera.CFrame.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then move = move - Camera.CFrame.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then move = move - Camera.CFrame.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then move = move + Camera.CFrame.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.E) then move = move + Vector3.new(0,1,0) end
        if UserInputService:IsKeyDown(Enum.KeyCode.Q) then move = move - Vector3.new(0,1,0) end
        FlyBV.Velocity = move.Unit * FlySpeed
        if move.Magnitude == 0 then FlyBV.Velocity = Vector3.new(0, 0.1, 0) end
    elseif FlyBV then
        DisableFly()
    end
end)

-- Fling (–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Ñ–ª–∏–Ω–≥)
local function FlingPlayer(player)
    if not player or not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
    if FlingToggles[player] then return end
    FlingToggles[player] = true
    coroutine.wrap(function()
        while FlingToggles[player] and player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") do
            player.Character.HumanoidRootPart.Velocity = Vector3.new(10000, 10000, 10000)
            RunService.Heartbeat:Wait()
        end
    end)()
end

local function StopFling(player)
    FlingToggles[player] = nil
end

-- AutoFarm
local function AutoFarmCoins()
    while AutoFarmEnabled do
        wait(0.5)
        pcall(function()
            for _, obj in pairs(workspace:GetChildren()) do
                if (obj.Name == "Coin" or obj.Name == "MoneyBag") and obj:IsA("Part") and LocalPlayer.Character then
                    local dist = (LocalPlayer.Character.HumanoidRootPart.Position - obj.Position).Magnitude
                    if dist < 50 then
                        LocalPlayer.Character.HumanoidRootPart.CFrame = obj.CFrame
                        wait(0.2)
                    end
                end
            end
        end)
    end
end

-- –ë–æ–µ–≤–∫–∞
local function KillPlayer(target)
    if target and target.Character and LocalPlayer.Character then
        LocalPlayer.Character.HumanoidRootPart.CFrame = target.Character.HumanoidRootPart.CFrame
        wait(0.1)
        if LocalPlayer.Character:FindFirstChildOfClass("Tool") then
            LocalPlayer.Character:FindFirstChildOfClass("Tool"):Activate()
        end
    end
end

local function FindMurderer()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            for _, container in ipairs({player.Backpack, player.Character}) do
                if container then
                    for _, tool in ipairs(container:GetChildren()) do
                        if tool:IsA("Tool") and string.lower(tool.Name):find("knife") then
                            return player
                        end
                    end
                end
            end
        end
    end
end

local function FindSheriff()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            for _, container in ipairs({player.Backpack, player.Character}) do
                if container then
                    for _, tool in ipairs(container:GetChildren()) do
                        if tool:IsA("Tool") and string.lower(tool.Name):find("gun") then
                            return player
                        end
                    end
                end
            end
        end
    end
end

-- === UI ===

-- –í–∫–ª–∞–¥–∫–∞ ESP/Chams
local ChamsTab = Window:CreateTab("Chams & Info", 4483362458)
ChamsTab:CreateToggle({
    Name = "üé® Enable Chams",
    CurrentValue = false,
    Callback = function(val)
        ChamsEnabled = val
        Rayfield:Notify({Title = "Chams " .. (val and "Enabled" or "Disabled"), Duration = 2})
    end,
})
ChamsTab:CreateToggle({
    Name = "üëÅÔ∏è Enable ESP",
    CurrentValue = false,
    Callback = function(val)
        ESPEnabled = val
        Rayfield:Notify({Title = "ESP " .. (val and "Enabled" or "Disabled"), Duration = 2})
    end,
})
ChamsTab:CreateToggle({
    Name = "üìè Enable Tracers (Bottom)",
    CurrentValue = false,
    Callback = function(val)
        TracersEnabled = val
        Rayfield:Notify({Title = "Tracers " .. (val and "Enabled" or "Disabled"), Duration = 2})
    end,
})

ChamsTab:CreateToggle({
    Name = "üî´ Highlight Dropped Gun",
    CurrentValue = false,
    Callback = function(val)
        if val then
            coroutine.wrap(function()
                while val do
                    wait(1)
                    local gunDrop = workspace:FindFirstChild("GunDrop")
                    if gunDrop then
                        local highlight = gunDrop:FindFirstChild("GunHighlight") or Instance.new("Highlight")
                        highlight.Name = "GunHighlight"
                        highlight.FillColor = Color3.new(1, 1, 0)
                        highlight.OutlineColor = Color3.new(1, 0, 0)
                        highlight.Parent = gunDrop
                    end
                end
            end)()
        end
    end,
})

-- Gun Tab
local GunTab = Window:CreateTab("Gun", 7733912645)
GunTab:CreateToggle({
    Name = "üéØ Silent Aim",
    CurrentValue = false,
    Callback = function(val)
        SilentAimEnabled = val
        Rayfield:Notify({
            Title = "Silent Aim " .. (val and "ACTIVATED" or "DEACTIVATED"),
            Content = val and "Auto-aim enabled" or "Manual aiming",
            Duration = 3
        })
    end,
})
GunTab:CreateButton({
    Name = "üî´ Shoot Murderer",
    Callback = function()
        local murderer = FindMurderer()
        if murderer then
            LocalPlayer.Character.HumanoidRootPart.CFrame = murderer.Character.HumanoidRootPart.CFrame
            Rayfield:Notify({Title = "üî´ Targeting Murderer", Content = murderer.Name, Duration = 3})
        else
            Rayfield:Notify({Title = "‚ùå Murderer not found", Duration = 3})
        end
    end
})
GunTab:CreateButton({
    Name = "üîÑ Grab Gun",
    Callback = function()
        local gunDrop = workspace:FindFirstChild("GunDrop")
        if gunDrop and LocalPlayer.Character then
            LocalPlayer.Character.HumanoidRootPart.CFrame = gunDrop.CFrame
            Rayfield:Notify({Title = "üî´ Gun Grabbed!", Duration = 3})
        else
            Rayfield:Notify({Title = "‚ùå Gun not found", Duration = 3})
        end
    end
})
GunTab:CreateToggle({
    Name = "‚ö° Auto Grab Gun",
    CurrentValue = false,
    Callback = function(val)
        AutoGrabGunEnabled = val
        if val then
            Rayfield:Notify({Title = "Auto Grab Gun ACTIVATED", Duration = 3})
            coroutine.wrap(function()
                while AutoGrabGunEnabled do
                    wait(2)
                    local gunDrop = workspace:FindFirstChild("GunDrop")
                    if gunDrop and LocalPlayer.Character then
                        LocalPlayer.Character.HumanoidRootPart.CFrame = gunDrop.CFrame
                    end
                end
            end)()
        end
    end,
})

-- Knife Tab
local KnifeTab = Window:CreateTab("Knife", 7733920848)
KnifeTab:CreateToggle({
    Name = "üíÄ Kill All Players",
    CurrentValue = false,
    Callback = function(val)
        KillAllEnabled = val
        if val then
            Rayfield:Notify({Title = "KILL ALL ACTIVATED", Content = "Killing all players...", Duration = 3})
            coroutine.wrap(function()
                while KillAllEnabled do
                    wait(1)
                    for _, p in pairs(Players:GetPlayers()) do
                        if p ~= LocalPlayer and p.Character then
                            KillPlayer(p)
                            wait(0.3)
                        end
                    end
                end
            end)()
        end
    end,
})
KnifeTab:CreateToggle({
    Name = "üî´ Kill Sheriff Only",
    CurrentValue = false,
    Callback = function(val)
        if val then
            Rayfield:Notify({Title = "Hunting Sheriff", Duration = 3})
            coroutine.wrap(function()
                while val do
                    wait(1)
                    local sheriff = FindSheriff()
                    if sheriff then KillPlayer(sheriff) end
                end
            end)()
        end
    end,
})
KnifeTab:CreateToggle({
    Name = "‚ö° Auto Kill All (Loop)",
    CurrentValue = false,
    Callback = function(val)
        AutoKillAllEnabled = val
        if val then
            Rayfield:Notify({Title = "AUTO KILL ACTIVATED", Content = "Continuous killing...", Duration = 3})
        end
    end,
})

-- Auto Farm
local FarmTab = Window:CreateTab("Auto Farm", 7733965351)
FarmTab:CreateToggle({
    Name = "üí∞ Toggle Auto Farm",
    CurrentValue = false,
    Callback = function(val)
        AutoFarmEnabled = val
        if val then
            Rayfield:Notify({Title = "AUTO FARM STARTED", Content = "Farming coins...", Duration = 3})
            coroutine.wrap(AutoFarmCoins)()
        else
            Rayfield:Notify({Title = "Auto Farm Stopped", Duration = 2})
        end
    end,
})
FarmTab:CreateSlider({
    Name = "Farm Speed",
    Range = {1, 10},
    Increment = 1,
    Suffix = "x",
    CurrentValue = 5,
    Callback = function(val)
        Rayfield:Notify({Title = "Farm Speed", Content = "Set to: " .. val .. "x", Duration = 2})
    end,
})
FarmTab:CreateToggle({
    Name = "üåÄ Fling Murder",
    CurrentValue = false,
    Callback = function(val)
        local murderer = FindMurderer()
        if murderer then
            if val then
                FlingPlayer(murderer)
                Rayfield:Notify({Title = "Fling Murder ACTIVATED", Duration = 3})
            else
                StopFling(murderer)
            end
        end
    end,
})

-- Miss Tab (Player management)
local MissTab = Window:CreateTab("Miss", 7733912645)
local PlayerList = {}
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then table.insert(PlayerList, player.Name) end
end
local PlayerDropdown = MissTab:CreateDropdown({
    Name = "Select Player",
    Options = PlayerList,
    CurrentOption = PlayerList[1] or "None",
    Callback = function(opt)
        Rayfield:Notify({Title = "Selected Player", Content = opt, Duration = 2})
    end,
})
MissTab:CreateButton({
    Name = "üåÄ Fling Selected Player",
    Callback = function()
        local selectedPlayer = Players:FindFirstChild(PlayerDropdown.CurrentOption)
        if selectedPlayer and selectedPlayer.Character then
            FlingPlayer(selectedPlayer)
            Rayfield:Notify({Title = "Flinging Player", Content = selectedPlayer.Name, Duration = 3})
        end
    end
})
MissTab:CreateButton({
    Name = "üî™ Fling Murder",
    Callback = function()
        local murderer = FindMurderer()
        if murderer and murderer.Character then
            FlingPlayer(murderer)
            Rayfield:Notify({Title = "Flinging Murderer", Content = murderer.Name, Duration = 3})
        end
    end
})
MissTab:CreateButton({
    Name = "üî´ Fling Sheriff/Hero",
    Callback = function()
        local sheriff = FindSheriff()
        if sheriff and sheriff.Character then
            FlingPlayer(sheriff)
            Rayfield:Notify({Title = "Flinging Sheriff", Content = sheriff.Name, Duration = 3})
        end
    end
})

-- Settings Tab
local SettingsTab = Window:CreateTab("Settings", 7733965351)
SettingsTab:CreateDropdown({
    Name = "üé® Select Theme",
    Options = {"Dark", "Amber", "Red", "Sky", "Rose"},
    CurrentOption = "Amber",
    Callback = function(opt)
        local themes = {
            Dark = Color3.fromRGB(25, 25, 25),
            Amber = Color3.fromRGB(255, 193, 7),
            Red = Color3.fromRGB(255, 0, 0),
            Sky = Color3.fromRGB(0, 150, 255),
            Rose = Color3.fromRGB(255, 0, 127)
        }
        Window:ChangeColor(themes[opt])
        Rayfield:Notify({Title = "Theme Changed", Content = opt, Duration = 2})
    end,
})
SettingsTab:CreateSlider({
    Name = "Window Transparency",
    Range = {0, 100},
    Increment = 5,
    Suffix = "%",
    CurrentValue = 0,
    Callback = function(val)
        Window:SetAttribute("Transparency", 1 - (val / 100))
        Rayfield:Notify({Title = "Transparency", Content = val .. "%", Duration = 2})
    end,
})

-- Credits Tab
local CreditsTab = Window:CreateTab("Credits", 7733920848)
CreditsTab:CreateLabel("MM2 Ultimate Cheat v8.1")
CreditsTab:CreateLabel("–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –†–ê–ë–û–ß–ò–ï!")
CreditsTab:CreateLabel("–°–∫–æ—Ä–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!")
CreditsTab:CreateLabel("–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: Telegram @PauseGpam")
CreditsTab:CreateButton({
    Name = "üîÑ Check for Updates",
    Callback = function()
        Rayfield:Notify({
            Title = "Update Check",
            Content = "Version 8.1 - Latest",
            Duration = 5,
        })
    end
})

-- –ì–õ–ê–í–ù–´–ô LOOP
RunService.RenderStepped:Connect(function()
    UpdateAllESP()
    if AutoKillAllEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                KillPlayer(player)
                wait(0.2)
            end
        end
    end
end)

-- FLY Toggle
SettingsTab:CreateToggle({
    Name = "üöÄ Enable Fly",
    CurrentValue = false,
    Callback = function(val)
        if val then
            EnableFly()
            Rayfield:Notify({Title = "Fly Enabled", Duration = 2})
        else
            DisableFly()
            Rayfield:Notify({Title = "Fly Disabled", Duration = 2})
        end
    end
})

-- –ó–∞–≥—Ä—É–∑–∫–∞
Rayfield:Notify({
    Title = "üéÆ MM2 ULTIMATE CHEAT v8.1",
    Content = "–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –†–ê–ë–û–¢–ê–Æ–¢! –ü—Ä–∏—è—Ç–Ω–æ–π –∏–≥—Ä—ã!",
    Duration = 6,
})

print("‚úÖ MM2 Ultimate Cheat v8.1 –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!")
