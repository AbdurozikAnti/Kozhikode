-- Murder Mystery 2 Ultimate Cheat v1.0

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local CoreGui = game:GetService("CoreGui")

local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "üé≠ MM2 Ultimate Cheat",
    LoadingTitle = "–ó–∞–≥—Ä—É–∂–∞–µ–º —á–∏—Ç —Å–∫—Ä–∏–ø—Ç...",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MM2UltimateCheat",
        FileName = "Config"
    },
    Discord = {
        Enabled = false
    },
    KeySystem = false
})

-- ====== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ======
local ESPEnabled = false
local FlyEnabled = false
local GodModeEnabled = false
local KillAllEnabled = false
local KillSheriffEnabled = false
local TimerEnabled = true

local FlySpeed = 50
local FlungPlayer = nil

local ESPObjects = {}

-- ====== –¢–ê–ô–ú–ï–† –†–ê–£–ù–î–ê ======

local RoundTimeSeconds = 180
local RoundStartTime = os.time()

local TimerGui = Instance.new("ScreenGui")
TimerGui.Name = "RoundTimerGui"
TimerGui.Parent = CoreGui

local TimerLabel = Instance.new("TextLabel")
TimerLabel.Size = UDim2.new(0, 200, 0, 40)
TimerLabel.Position = UDim2.new(0.5, -100, 0, 10)
TimerLabel.BackgroundColor3 = Color3.fromRGB(0,0,0)
TimerLabel.BackgroundTransparency = 0.4
TimerLabel.TextColor3 = Color3.new(1,1,1)
TimerLabel.TextScaled = true
TimerLabel.Font = Enum.Font.GothamBold
TimerLabel.Text = "–†–∞—É–Ω–¥: –æ–∂–∏–¥–∞–Ω–∏–µ..."
TimerLabel.Parent = TimerGui

local function UpdateRoundTimer()
    if not TimerEnabled then
        TimerLabel.Visible = false
        return
    else
        TimerLabel.Visible = true
    end

    local elapsed = os.time() - RoundStartTime
    local left = RoundTimeSeconds - elapsed
    if left <= 0 then
        TimerLabel.Text = "–†–∞—É–Ω–¥ –æ–∫–æ–Ω—á–µ–Ω. –ñ–¥–µ–º –Ω–æ–≤—ã–π..."
        wait(5)
        RoundStartTime = os.time()
    else
        TimerLabel.Text = string.format("–†–∞—É–Ω–¥: %02d:%02d", math.floor(left/60), left%60)
    end
end

-- ====== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ESP ======

local function CreateESP(player)
    if ESPObjects[player] then return end
    local character = player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") or not character:FindFirstChild("Head") then return end

    local highlight = Instance.new("Highlight")
    highlight.Adornee = character
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.FillTransparency = 0.7
    highlight.OutlineTransparency = 0
    highlight.Parent = character

    local tracerPart = Instance.new("Part")
    tracerPart.Name = "Tracer_" .. player.Name
    tracerPart.Anchored = true
    tracerPart.CanCollide = false
    tracerPart.Size = Vector3.new(0.1, 0.1, 0.1)
    tracerPart.Transparency = 1
    tracerPart.Material = Enum.Material.Neon
    tracerPart.Parent = Workspace

    local attachment0 = Instance.new("Attachment", tracerPart)
    local attachment1 = Instance.new("Attachment", character.HumanoidRootPart)

    local beam = Instance.new("Beam")
    beam.Attachment0 = attachment0
    beam.Attachment1 = attachment1
    beam.Width0 = 0.1
    beam.Width1 = 0.1
    beam.Color = ColorSequence.new(Color3.new(1,1,1))
    beam.Transparency = NumberSequence.new(0.5)
    beam.FaceCamera = true
    beam.Parent = tracerPart

    local billboard = Instance.new("BillboardGui")
    billboard.Adornee = character.Head
    billboard.Size = UDim2.new(0, 150, 0, 40)
    billboard.StudsOffset = Vector3.new(0, 3.5, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = character.Head

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, 0, 1, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextColor3 = Color3.new(1, 1, 1)
    nameLabel.TextScaled = true
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.Text = player.Name
    nameLabel.Parent = billboard

    ESPObjects[player] = {
        Highlight = highlight,
        TracerPart = tracerPart,
        Attachment0 = attachment0,
        Attachment1 = attachment1,
        Beam = beam,
        Billboard = billboard,
        NameLabel = nameLabel
    }
end

local function RemoveESP(player)
    local esp = ESPObjects[player]
    if esp then
        for _, obj in pairs(esp) do
            if obj and obj.Parent then
                obj:Destroy()
            end
        end
        ESPObjects[player] = nil
    end
end

local function UpdateESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player == LocalPlayer then continue end
        local character = player.Character
        if not character or not character:FindFirstChild("HumanoidRootPart") or not character:FindFirstChild("Humanoid") then
            RemoveESP(player)
            continue
        end
        if character.Humanoid.Health <= 0 then
            RemoveESP(player)
            continue
        end
        if ESPEnabled then
            if not ESPObjects[player] then CreateESP(player) end

            -- –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–æ–ª—å –∏ —Ü–≤–µ—Ç
            local role = "–ù–µ–≤–∏–Ω–Ω—ã–π"
            local color = Color3.new(0, 1, 0)

            local containers = {player.Backpack, character}
            for _, container in ipairs(containers) do
                if container then
                    for _, tool in ipairs(container:GetChildren()) do
                        if tool:IsA("Tool") then
                            local tname = string.lower(tool.Name)
                            if tname:find("knife") or tname:find("–Ω–æ–∂") then
                                role = "–£–±–∏–π—Ü–∞"
                                color = Color3.new(1, 0, 0)
                            elseif tname:find("gun") or tname:find("–ø—É—à–∫–∞") then
                                role = "–®–µ—Ä–∏—Ñ"
                                color = Color3.new(0, 0, 1)
                            end
                        end
                    end
                end
            end

            local esp = ESPObjects[player]
            esp.Highlight.FillColor = color
            esp.Beam.Color = ColorSequence.new(color)
            esp.TracerPart.BrickColor = BrickColor.new(color)
            esp.NameLabel.TextColor3 = color

            -- –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –¥–ª—è —Ç—Ä–µ–π—Å–µ—Ä–∞
            local localRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if localRoot then
                esp.TracerPart.Position = localRoot.Position + Vector3.new(0, -3, 0)
                esp.Attachment0.Position = Vector3.new(0, 0, 0)
                esp.Attachment1.WorldPosition = character.HumanoidRootPart.Position
            end
        else
            RemoveESP(player)
        end
    end
end

-- ======= God Mode =======
local function SetGodMode(enabled)
    if not LocalPlayer.Character then return end
    local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid.MaxHealth = enabled and math.huge or 100
        humanoid.Health = humanoid.MaxHealth
    end
end

-- ====== Teleport —Ñ—É–Ω–∫—Ü–∏–∏ ======
local function TeleportToLobby()
    local TeleportService = game:GetService("TeleportService")
    pcall(function()
        TeleportService:Teleport(142823291, LocalPlayer)
    end)
end

local function TeleportToPlayerWithRole(roleName)
    for _, player in pairs(Players:GetPlayers()) do
        if player == LocalPlayer then continue end
        local containers = {player.Backpack, player.Character}
        for _, container in ipairs(containers) do
            if container then
                for _, tool in ipairs(container:GetChildren()) do
                    if tool:IsA("Tool") then
                        local nameLower = string.lower(tool.Name)
                        if (roleName == "–£–±–∏–π—Ü–∞" and (nameLower:find("knife") or nameLower:find("–Ω–æ–∂"))) or
                            (roleName == "–®–µ—Ä–∏—Ñ" and (nameLower:find("gun") or nameLower:find("–ø—É—à–∫–∞"))) then
                            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                                LocalPlayer.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame
                                return
                            end
                        end
                    end
                end
            end
        end
    end
end

-- ====== Fly —Å–∏—Å—Ç–µ–º–∞ ======
local FlyToggled = false

local function ToggleFly()
    local chr = LocalPlayer.Character
    local hum = chr and chr:FindFirstChildOfClass("Humanoid")
    if not chr or not hum then return end

    if FlyToggled then
        FlyToggled = false
        hum.PlatformStand = false
        for _, state in pairs(Enum.HumanoidStateType:GetEnumItems()) do
            hum:SetStateEnabled(state, true)
        end
        local torso = chr:FindFirstChild("UpperTorso") or chr:FindFirstChild("Torso")
        if torso then
            local bg = torso:FindFirstChild("BodyGyro")
            local bv = torso:FindFirstChild("BodyVelocity")
            if bg then bg:Destroy() end
            if bv then bv:Destroy() end
        end
        if chr:FindFirstChild("Animate") then
            chr.Animate.Disabled = false
        end
    else
        FlyToggled = true
        if chr:FindFirstChild("Animate") then
            chr.Animate.Disabled = true
        end
        for _, state in pairs(Enum.HumanoidStateType:GetEnumItems()) do
            hum:SetStateEnabled(state, false)
        end
        local torso = chr:FindFirstChild("UpperTorso") or chr:FindFirstChild("Torso")
        if torso then
            local bg = Instance.new("BodyGyro", torso)
            bg.P = 9e4
            bg.MaxTorque = Vector3.new(9e9,9e9,9e9)
            bg.CFrame = torso.CFrame

            local bv = Instance.new("BodyVelocity", torso)
            bv.Velocity = Vector3.new(0,0.1,0)
            bv.MaxForce = Vector3.new(9e9,9e9,9e9)

            hum.PlatformStand = true

            RunService:BindToRenderStep("Fly", 301, function()
                local moveDir = Vector3.new()
                local cam = Workspace.CurrentCamera
                if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveDir = moveDir + cam.CFrame.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveDir = moveDir - cam.CFrame.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveDir = moveDir - cam.CFrame.RightVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveDir = moveDir + cam.CFrame.RightVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.E) then moveDir = moveDir + Vector3.new(0,1,0) end
                if UserInputService:IsKeyDown(Enum.KeyCode.Q) then moveDir = moveDir - Vector3.new(0,1,0) end

                if moveDir.Magnitude > 0 then
                    bv.Velocity = moveDir.Unit * FlySpeed
                    bg.CFrame = cam.CFrame
                else
                    bv.Velocity = Vector3.new()
                end
            end)
        end
    end
end

-- ====== GUI ======

local MainTab = Window:CreateTab("–ì–ª–∞–≤–Ω–∞—è")

MainTab:CreateToggle({
    Name = "–í–∫–ª—é—á–∏—Ç—å ESP",
    CurrentValue = false,
    Callback = function(value)
        ESPEnabled = value
        if not value then
            for _, p in pairs(Players:GetPlayers()) do
                RemoveESP(p)
            end
        end
    end,
})

MainTab:CreateToggle({
    Name = "God Mode",
    CurrentValue = false,
    Callback = function(value)
        GodModeEnabled = value
        SetGodMode(value)
    end,
})

MainTab:CreateToggle({
    Name = "Fly (L)",
    CurrentValue = false,
    Flag = "FlyToggle",
    Callback = function(value)
        FlyEnabled = value
        ToggleFly()
    end,
})

MainTab:CreateSlider({
    Name = "–°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–ª—ë—Ç–∞",
    Range = {10, 150},
    Increment = 5,
    CurrentValue = FlySpeed,
    Suffix = " speed",
    Callback = function(value)
        FlySpeed = value
    end,
})

MainTab:CreateButton({
    Name = "–¢–µ–ª–µ–ø–æ—Ä—Ç –≤ –ª–æ–±–±–∏",
    Callback = TeleportToLobby
})

MainTab:CreateButton({
    Name = "–¢–µ–ª–µ–ø–æ—Ä—Ç –∫ –®–µ—Ä–∏—Ñ—É",
    Callback = function() TeleportToPlayerWithRole("–®–µ—Ä–∏—Ñ") end
})

MainTab:CreateButton({
    Name = "–¢–µ–ª–µ–ø–æ—Ä—Ç –∫ –£–±–∏–π—Ü–µ",
    Callback = function() TeleportToPlayerWithRole("–£–±–∏–π—Ü–∞") end
})

MainTab:CreateLabel("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –¥–ª—è —Ñ–ª–∏–Ω–≥–∞")
local flingInput = MainTab:CreateTextbox({
    Name = "–ù–∏–∫ –∏–≥—Ä–æ–∫–∞",
    PlaceholderText = "–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫...",
    Callback = function(v)
        FlungPlayer = Players:FindFirstChild(v)
    end
})

MainTab:CreateButton({
    Name = "–§–ª–∏–Ω–≥ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ",
    Callback = function()
        if FlungPlayer then
            coroutine.wrap(function()
                local root = FlungPlayer.Character and FlungPlayer.Character:FindFirstChild("HumanoidRootPart")
                if root and LocalPlayer.Character then
                    for i=1,50 do
                        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                            LocalPlayer.Character.HumanoidRootPart.CFrame = root.CFrame * CFrame.new(math.random(-15,15), 5, math.random(-15,15))
                            RunService.Heartbeat:Wait()
                        end
                    end
                end
            end)()
        end
    end
})

MainTab:CreateToggle({
    Name = "Kill All (—Ä–µ–∂–∏–º)",
    CurrentValue = false,
    Callback = function(v)
        KillAllEnabled = v
        if v then
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame
                    task.wait(0.2)
                end
            end
        end
    end
})

MainTab:CreateToggle({
    Name = "Kill Sheriff",
    CurrentValue = false,
    Callback = function(v)
        KillSheriffEnabled = v
        if v then
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LocalPlayer then
                    for _, container in ipairs({player.Backpack, player.Character}) do
                        if container then
                            for _, tool in pairs(container:GetChildren()) do
                                if tool:IsA("Tool") and (string.lower(tool.Name):find("gun") or string.lower(tool.Name):find("–ø—É—à–∫–∞")) then
                                    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                                        LocalPlayer.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame
                                        task.wait(0.2)
                                    end
                                end
                            end
                        end
                    end
                end
            end
        end
    end
})

-- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è ESP –∏ —Ç–∞–π–º–µ—Ä–∞
RunService.Heartbeat:Connect(function()
    UpdateESP()
    UpdateRoundTimer()
end)

print("MM2 Ultimate Cheat –∑–∞–≥—Ä—É–∂–µ–Ω!")
