local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

local AimLockEnabled = false
local AltLockEnabled = false
local AutoFarmEnabled = false
local Target = nil

-- GUI
local ScreenGui = Instance.new("ScreenGui", LocalPlayer.PlayerGui)
ScreenGui.ResetOnSpawn = false

local function CreateButton(text, position)
    local btn = Instance.new("TextButton", ScreenGui)
    btn.Size = UDim2.new(0, 120, 0, 50)
    btn.Position = position
    btn.Text = text
    btn.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.TextScaled = true
    return btn
end

local AimLockBtn = CreateButton("AimLock OFF", UDim2.new(0, 10, 0.8, 0))
local AltLockBtn = CreateButton("AltLock OFF", UDim2.new(0, 140, 0.8, 0))
local AutoFarmBtn = CreateButton("AutoFarm OFF", UDim2.new(0, 270, 0.8, 0))

-- Нахождение ближайшей цели
local function GetClosestTarget()
    local closest
    local shortestDistance = math.huge
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local screenPos, onScreen = workspace.CurrentCamera:WorldToScreenPoint(player.Character.HumanoidRootPart.Position)
            if onScreen then
                local distance = (Vector2.new(screenPos.X, screenPos.Y) - Vector2.new(Mouse.X, Mouse.Y)).Magnitude
                if distance < shortestDistance and distance < 150 then
                    closest = player
                    shortestDistance = distance
                end
            end
        end
    end
    return closest
end

local function AimAtTarget(target)
    if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
        local targetPos = target.Character.HumanoidRootPart.Position
        local screenPos = workspace.CurrentCamera:WorldToScreenPoint(targetPos)
        if screenPos.Z > 0 then
            -- mousemoveabs может не работать на телефоне, здесь можно добавить альтернативу или оставить заглушку
            -- mousemoveabs(screenPos.X, screenPos.Y)
        end
    end
end

-- Кнопки включения/выключения функций
AimLockBtn.MouseButton1Click:Connect(function()
    AimLockEnabled = not AimLockEnabled
    AimLockBtn.Text = "AimLock " .. (AimLockEnabled and "ON" or "OFF")
end)

AltLockBtn.MouseButton1Click:Connect(function()
    AltLockEnabled = not AltLockEnabled
    AltLockBtn.Text = "AltLock " .. (AltLockEnabled and "ON" or "OFF")
end)

AutoFarmBtn.MouseButton1Click:Connect(function()
    AutoFarmEnabled = not AutoFarmEnabled
    AutoFarmBtn.Text = "AutoFarm " .. (AutoFarmEnabled and "ON" or "OFF")
end)

RunService.RenderStepped:Connect(function()
    if AimLockEnabled or AltLockEnabled then
        Target = GetClosestTarget()
        if Target then
            AimAtTarget(Target)
        end
    end

    if AutoFarmEnabled then
        local npcList = workspace:FindFirstChild("Enemies")
        if npcList then
            for _, npc in pairs(npcList:GetChildren()) do
                if npc:FindFirstChild("Humanoid") and npc.Humanoid.Health > 0 then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = npc.HumanoidRootPart.CFrame * CFrame.new(0, 0, 3)
                    if npc:FindFirstChild("ClickDetector") then
                        fireclickdetector(npc.ClickDetector)
                    end
                    wait(0.5)
                end
            end
        end
    end
end)
